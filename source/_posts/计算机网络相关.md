---
title: 计算机网络相关
date: 2018-12-07 16:18:29
tags: network
categories: network
---

记录计算机网络原理，流量分析相关。

<!--more-->

## 使用tshark过滤HTTPS流量

```POWERSHELL
foreach($f in gci pcaps *pcap)
{
	tshark -r $f.FullName -Y "tcp.port==443" -F pcap -w filtered_pcap\$($f.BaseName).pcap
	echo finised:($f.BaseName)
}
```

- -r：表示加载本地文件
- -Y：表示过滤条件，这里过滤条件是443端口
- -F：表示存储的格式，这里指定pcap，如果指定为pcapng则SplitCap不能加载
- -w：表示存储文件

## 使用SplitCap切分流

```powershell
foreach($f in gci 1_Pcap *.pcap)
{
    SplitCap -p 100000 -b 100000 -r $f.FullName -o 2_Session\AllLayers\$($f.BaseName)-ALL
    SplitCap -p 100000 -b 100000 -r $f.FullName -s flow -o 2_Session\AllLayers\$($f.BaseName)-ALL
    
    gci 2_Session\AllLayers\$($f.BaseName)-ALL | ?{$_.Length -eq 0} | del

    SplitCap -p 100000 -b 100000 -r $f.FullName -o 2_Session\L7\$($f.BaseName)-L7 -y L7
    SplitCap -p 100000 -b 100000 -r $f.FullName -s flow -o 2_Session\L7\$($f.BaseName)-L7 -y L7

    gci 2_Session\L7\$($f.BaseName)-L7 | ?{$_.Length -eq 0} | del
}

finddupe -del 2_Session\AllLayers
finddupe -del 2_Session\L7
```

- 等待被处理的文件

![](计算机网络相关/splitcap-1.png)

- 处理之后的文件

![](计算机网络相关/splitcap-2.png)

![](计算机网络相关/splitcap-3.png)

## nslookup批量处理域名

```sh
#!/usr/bin/env bash
echo "############# Reverse DNS ##############"
while read id servername;do
    ip=$(nslookup $servername | grep ^Name -A1 | grep Address | awk '{printf ($2" ")}');
    echo "$id,$servername,$ip";
done<$1 >$2
```

以上，$1是第一个参数，就是要打开的域名文件，$2是跟在命令后的第二个参数，是需要保存结果的文件。^Name -A1表示:找到以Name开头的行，-A1表示显示下一行，grep的具体使用如下：

```
使用方式：grep [OPTIONS] PATTERN [FILE...]
grep [OPTIONS] [-e PATTERN | -f FILE] [FILE...]
常用选项：
　--color=auto：对匹配到的文本着色后进行高亮显示；
　-i：忽略字符的大小写
　-o：仅显示匹配到的字符串
　-v：显示不能被模式匹配到的行
　-E：支持使用扩展的正则表达式
　-q：静默模式，即不输出任何信息
　-A #：显示被模式匹配的行及其后#行
　-B #：显示被模式匹配的行及其前#行
　-C #：显示被模式匹配的行及其前后各#行
```

